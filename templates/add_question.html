{% extends "base.html" %} {% import 'macros.html' as macros %}
{% block content %}

<style>
  #AddQuestionForm{
  	display: none;
      width: 300px;
      border: 1px solid #ccc;
      padding: 14px;
      background: #ececec;
  }

  table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }

  td, th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
  }
</style>

<script>
$(document).ready(function(){
	$('#AddQuestionButton').click(function(){
  		$('#AddQuestionForm').toggle(500);
  });

  $('.start-question-btn').click(function() {
    $('.start-question-btn').prop('disabled', true);
    $('.end-question-btn').prop('disabled', true);
    var qid = $(this).data('qid');
    var crn = $(this).data('crn');
    var data = {
        crn: crn,
        qid: qid
    }
    $.post("/set-active-question", data, function(data, status) {
        console.log(`${data} and status is ${status}`)
        location.reload();
    });
  });

  $('.end-question-btn').click(function() {
  $('.start-question-btn').prop('disabled', true);
    $('.end-question-btn').prop('disabled', true);
    var crn = $(this).data('crn');
    var data = {
        crn: crn,
        qid: null
    }
    $.post("/set-active-question", data, function(data, status) {
        console.log(`${data} and status is ${status}`)
        location.reload();
    });
  });
});


</script>

<form action="/logout" method="post">
    <button type="submit" style="float: right;">Log Out</button>
</form>
<div class="col-md-4 col-md-offset-4">

      <div align="center">
        <h2>Instructor Dashboard for {{current_user.name}}</h2>
        <hr>
        <h2>CRN: {{CRN}}</h2>
      </div>

<br>
<div>
    {{active_question}}
  <h4>Questions</h4>
      <table>
      <tbody>
      <tr>
          <td>id</td>
          <td>Date</td>
          <td>Content</td>
          <td>Start/End question</td>
      </tr>
        {% for q in query_results %}
          <tr>
            <td>{{ q[0] }}</td>
            <td>{{ q[1] }}</td>
            <td>{{ q[2] }}</td>
            <td>
                {% if active_question == q[0] %}
                    <button id="question-btn-{{q[0]}}" class="btn btn-primary end-question-btn" data-qid="{{q[0]}}" data-crn="{{CRN}}">End</button>
                {% else %}
                    <button id="question-btn-{{q[0]}}" class="btn btn-primary start-question-btn" data-qid="{{q[0]}}" data-crn="{{CRN}}">Start</button>
                {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
      </table>
  <br>
<button id="AddQuestionButton" class="btn btn-primary">Add Question</button>
  <form id="AddQuestionForm" action="/dashboard/instructor/course/question/{{CRN}}" method="post">
      {{ add_question_form.hidden_tag() }}
      {{ macros.render_field(add_question_form.question_date, placeholder='MM/DD/YYYY', label_visible=true) }}
      {{ macros.render_field(add_question_form.question, placeholder='', label_visible=true) }}
      <button type="submit" class="btn btn-default">Submit</button>
  </form>

</div>

{% endblock %}
